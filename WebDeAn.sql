
CREATE DATABASE WEBDB_DOHOANGNHAN_2211110151
GO
USE WEBDB_DOHOANGNHAN_2211110151
GO
CREATE TABLE TBL_SANPHAM
(
    IDSP INT IDENTITY PRIMARY KEY,
    MASP VARCHAR(100) NOT NULL,
    TENSP NVARCHAR(200) NOT NULL,
    GIATIEN FLOAT NOT NULL,
    GIACU FLOAT,
    SO_LUONG_TON_TRONG_KHO INT,
    HINH_DAI_DIEN NVARCHAR(100), -- LUU DUONG DAN + TEN CUA HINH
    HINH_CHI_TIET_1 NVARCHAR(100), 
    HINH_CHI_TIET_2 NVARCHAR(100), 
    HINH_CHI_TIET_3 NVARCHAR(100), 
    HINH_CHI_TIET_4 NVARCHAR(100),
	IDLOAI INT
)
CREATE TABLE TBL_LOAISANPHAM
(
    IDLOAI INT IDENTITY PRIMARY KEY,
    TENLOAI NVARCHAR(100) NOT NULL,
	HINHANH NVARCHAR(100),
)


ALTER TABLE TBL_SANPHAM
ADD CONSTRAINT FK_SANPHAM_LOAISANPHAM FOREIGN KEY (IDLOAI)
REFERENCES TBL_LOAISANPHAM(IDLOAI)


CREATE TABLE TBL_HOADON
(
    IDHD INT IDENTITY PRIMARY KEY,
    MAHD VARCHAR(100), -- LUU MA HOA DON
    TEN_KHACH_HANG NVARCHAR(100) NOT NULL,
    SDT VARCHAR(20) NOT NULL,
    EMAIL NVARCHAR(100),
	GHICHU NVARCHAR(MAX),
    TONG_THANH_TIEN FLOAT,
    TRANG_THAI INT NOT NULL,
	NGAYBAN DATETIME
)


CREATE TABLE TBL_HOADON_CHITIET
(
    IDCTHD INT IDENTITY PRIMARY KEY,
    MAHD VARCHAR(100) NOT NULL,
    MASP VARCHAR(100) NOT NULL,
    TENSP NVARCHAR(200) NOT NULL,
    GIATIEN FLOAT NOT NULL,
    SOLUONG INT NOT NULL,
    THANH_TIEN FLOAT NOT NULL,
	THANG INT NOT NULL,
	IDLOAI INT NOT NULL
)

	
CREATE TABLE TAIKHOAN
(
    EMAIL NVARCHAR(100) NOT NULL PRIMARY KEY,
    PASSWORD NVARCHAR(200) NOT NULL,
    PASSWORDSALT NVARCHAR(200) NOT NULL,
    ACCESS INT NULL
)
GO
ALTER TABLE TBL_SANPHAM
ADD NOIDUNG_MOTA_SANPHAM NTEXT
GO

USE WEBDB_DOHOANGNHAN_2211110151
GO
ALTER TABLE TBL_SANPHAM
ADD THANG INT;

USE WEBDB_DOHOANGNHAN_2211110151
GO
UPDATE TBL_HOADON_CHITIET
SET 
    TBL_HOADON_CHITIET.THANG = TBL_SANPHAM.THANG,
    TBL_HOADON_CHITIET.IDLOAI = TBL_SANPHAM.IDLOAI
FROM 
    TBL_HOADON_CHITIET
JOIN 
    TBL_SANPHAM ON TBL_HOADON_CHITIET.MASP = TBL_SANPHAM.MASP;




UPDATE TBL_SANPHAM
SET THANG = 1
WHERE IDLOAI IN (1, 2);

UPDATE TBL_SANPHAM
SET THANG = 3
WHERE IDLOAI IN (3, 4);


USE WEBDB_DOHOANGNHAN_2211110151
GO
SELECT * FROM TBL_SANPHAM;

ALTER TABLE TBL_HOADON_CHITIET
ADD LICENSE_KEYS NVARCHAR(MAX);


USE WEBDB_DOHOANGNHAN_2211110151;
GO
ALTER TABLE TBL_HOADON
ADD CONSTRAINT FK_HOADON_TAIKHOAN FOREIGN KEY (EMAIL) REFERENCES TAIKHOAN(EMAIL);


INSERT INTO TBL_LOAISANPHAM (TENLOAI, HINHANH) 
VALUES 
(N'Netflix Premium', 'https://thegioiapp.vn/wp-content/uploads/2021/11/netflix-premium.png'),
(N'Spotify Premium', 'https://getnhanh.net/wp-content/uploads/2021/10/mua-Spotify-Premium-gia-re1.jpeg'),
(N'Key Windows', 'https://khotaikhoan.net/wp-content/uploads/2023/09/Key-window-11pro.png'),
(N'Steam wallet', 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ2t5OZb6oQV5ijFsUIm3GX6Zw1Xiv_3YsDPg&s'),
(N'YouTube Premium', 'https://itcuaban.com/wp-content/uploads/2022/10/nang-cap-youtube-premium.jpg'),
(N'ChatGPT (OpenAI) Tài khoản', 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTZ-WZAIAjGp-FVF1FSlJCILqCzvIbYZv255A&s')



INSERT INTO TBL_SANPHAM (MASP, TENSP, GIATIEN, GIACU, SO_LUONG_TON_TRONG_KHO, HINH_DAI_DIEN, HINH_CHI_TIET_1, HINH_CHI_TIET_2, HINH_CHI_TIET_3, HINH_CHI_TIET_4, NOIDUNG_MOTA_SANPHAM, IDLOAI) 
VALUES 
('MASP-01', N'Sản phẩm số 01', 100, 0, 10, 
'https://dummyimage.com/450x300/dee2e6/6c757d.jpg', 
'https://dummyimage.com/450x300/dee2e6/6c757d.jpg', 
'https://dummyimage.com/450x300/dee2e6/6c757d.jpg', 
'https://dummyimage.com/450x300/dee2e6/6c757d.jpg', 
'https://dummyimage.com/450x300/dee2e6/6c757d.jpg', 
NULL, 1)

INSERT INTO TBL_SANPHAM (MASP, TENSP, GIATIEN, GIACU, SO_LUONG_TON_TRONG_KHO, HINH_DAI_DIEN, HINH_CHI_TIET_1, HINH_CHI_TIET_2, HINH_CHI_TIET_3, HINH_CHI_TIET_4, NOIDUNG_MOTA_SANPHAM, IDLOAI) 
VALUES 
('MASP-02', N'Sản phẩm số 02', 200, 0, 20, 
'https://dummyimage.com/450x300/dee2e6/6c757d.jpg', 
'https://dummyimage.com/450x300/dee2e6/6c757d.jpg', 
'https://dummyimage.com/450x300/dee2e6/6c757d.jpg', 
'https://dummyimage.com/450x300/dee2e6/6c757d.jpg', 
'https://dummyimage.com/450x300/dee2e6/6c757d.jpg', 
NULL, 2)

INSERT INTO TBL_SANPHAM (MASP, TENSP, GIATIEN, GIACU, SO_LUONG_TON_TRONG_KHO, HINH_DAI_DIEN, HINH_CHI_TIET_1, HINH_CHI_TIET_2, HINH_CHI_TIET_3, HINH_CHI_TIET_4, NOIDUNG_MOTA_SANPHAM, IDLOAI) 
VALUES 
('MASP-03', N'Sản phẩm số 03', 300, 0, 30, 
'https://dummyimage.com/450x300/dee2e6/6c757d.jpg', 
'https://dummyimage.com/450x300/dee2e6/6c757d.jpg', 
'https://dummyimage.com/450x300/dee2e6/6c757d.jpg', 
'https://dummyimage.com/450x300/dee2e6/6c757d.jpg', 
'https://dummyimage.com/450x300/dee2e6/6c757d.jpg', 
NULL, 3)

INSERT INTO TBL_SANPHAM (MASP, TENSP, GIATIEN, GIACU, SO_LUONG_TON_TRONG_KHO, HINH_DAI_DIEN, HINH_CHI_TIET_1, HINH_CHI_TIET_2, HINH_CHI_TIET_3, HINH_CHI_TIET_4, NOIDUNG_MOTA_SANPHAM, IDLOAI) 
VALUES 
('MASP-04', N'Sản phẩm số 04', 400, 0, 40, 
'https://dummyimage.com/450x300/dee2e6/6c757d.jpg', 
'https://dummyimage.com/450x300/dee2e6/6c757d.jpg', 
'https://dummyimage.com/450x300/dee2e6/6c757d.jpg', 
'https://dummyimage.com/450x300/dee2e6/6c757d.jpg', 
'https://dummyimage.com/450x300/dee2e6/6c757d.jpg', 
NULL, 1)





INSERT INTO TAIKHOAN (EMAIL, PASSWORD, PASSWORDSALT, ACCESS) 
VALUES (N'user@gmail.com', N'7j1RowzqFBxv0e9MRKQGq06BLhhmuoRjyydgv+zOqy2X+KFHE8+gzGFLfDF5729zrXl8//4UN8QNHFXu2PIGug==', 
N'100000.w5nRV8DRQOO18sVum0ZD6Cg0SH0U0817kpTPvyG0Y5TmVw==', 0)




USE WEBDB_DOHOANGNHAN_2211110151
GO
CREATE TABLE TBL_MAKEY
(
    ID INT IDENTITY PRIMARY KEY,
    MASP VARCHAR(100) NOT NULL,
    MAKEY NVARCHAR(MAX) NOT NULL,
    IS_USED BIT DEFAULT 0
);

-- Insert license keys for MASP-01
INSERT INTO TBL_MAKEY (MASP, MAKEY) VALUES 
('MASP-01', '84f3308e-742e-4c96-942e-42dbf6ce808b'),
('MASP-01', NEWID()), ('MASP-01', NEWID()), ('MASP-01', NEWID()), ('MASP-01', NEWID()), 
('MASP-01', NEWID()), ('MASP-01', NEWID()), ('MASP-01', NEWID()), ('MASP-01', NEWID()), ('MASP-01', NEWID());

-- Insert license keys for MASP-02
INSERT INTO TBL_MAKEY (MASP, MAKEY) VALUES 
('MASP-02', '7b87407e-3857-453c-80f6-86d438c2d3c5'),
('MASP-02', NEWID()), ('MASP-02', NEWID()), ('MASP-02', NEWID()), ('MASP-02', NEWID()), 
('MASP-02', NEWID()), ('MASP-02', NEWID()), ('MASP-02', NEWID()), ('MASP-02', NEWID()), ('MASP-02', NEWID());

-- Insert license keys for MASP-03
INSERT INTO TBL_MAKEY (MASP, MAKEY) VALUES 
('MASP-03', '3939b53f-9598-4a91-9d1c-7886f9a3d244'),
('MASP-03', NEWID()), ('MASP-03', NEWID()), ('MASP-03', NEWID()), ('MASP-03', NEWID()), 
('MASP-03', NEWID()), ('MASP-03', NEWID()), ('MASP-03', NEWID()), ('MASP-03', NEWID()), ('MASP-03', NEWID());

-- Insert license keys for MASP-04
INSERT INTO TBL_MAKEY (MASP, MAKEY) VALUES 
('MASP-04', '47ffe896-cabe-405a-bac3-3c319aaa2523'),
('MASP-04', NEWID()), ('MASP-04', NEWID()), ('MASP-04', NEWID()), ('MASP-04', NEWID()), 
('MASP-04', NEWID()), ('MASP-04', NEWID()), ('MASP-04', NEWID()), ('MASP-04', NEWID()), ('MASP-04', NEWID());


USE WEBDB_DOHOANGNHAN_2211110151
GO 
UPDATE TBL_MAKEY
SET IS_USED = 0
WHERE IS_USED IS NULL;


ALTER TABLE TBL_MAKEY
ALTER COLUMN IS_USED BIT NOT NULL;


ALTER TABLE TBL_MAKEY
ADD CONSTRAINT DF_TBL_MAKEY_IS_USED DEFAULT 0 FOR IS_USED;


SELECT * FROM TBL_MAKEY;